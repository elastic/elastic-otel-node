# A `docker compose` config file to run tests services for testing
# `@elastic/opentelemetry-node`.
#
# Usage:
#   npm run test-services:start [services...]
#   npm run test-services:stop [services...]

name: test-services

services:
  redis:
    image: redis:7
    ports:
      - "6379:6379"
    healthcheck:
      test: ["CMD", "redis-cli", "ping"]
      interval: 1s
      timeout: 10s
      retries: 30

  mongodb:
    # TODO: discuss here if keep this version or use latest (7)
    # my take is this is preferred if we want to run TAV tests
    image: mongo:7
    ports:
      - "27017:27017"
    volumes:
      - nodemongodata:/data/db
    healthcheck:
      test: ["CMD", "mongo", "--quiet"]
      interval: 1s
      timeout: 10s
      retries: 30

volumes:
  nodemongodata:
    driver: local
